<!DOCTYPE html>
<html>
<head>
    <title>Test Toggle Buttons</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .group { margin: 10px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .btn { padding: 10px 20px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-active { background: #10b981; color: white; }
        .btn-inactive { background: #3b82f6; color: white; }
        .btn-loading { background: #f59e0b; color: white; }
        .status { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <h1>🎯 Test Toggle Buttons dla Grup Startowych</h1>
    <div id="groups"></div>
    <div id="log" style="margin-top: 20px; padding: 10px; background: #f3f4f6; border-radius: 5px;"></div>

    <script>
        let grupyStatuses = {};

        async function loadGroupStatuses() {
            try {
                const response = await fetch('/api/start-queue/all-group-statuses');
                const data = await response.json();
                grupyStatuses = data.statuses || {};
                log('📊 Statusy grup załadowane: ' + JSON.stringify(grupyStatuses, null, 2));
                renderGroups();
            } catch (error) {
                log('❌ Błąd ładowania statusów: ' + error.message);
            }
        }

        async function toggleGroup(categoria, plec, nazwa) {
            const groupKey = `${categoria}_${plec}`;
            const currentStatus = grupyStatuses[groupKey]?.is_active || false;
            
            log(`🔄 Toggle ${nazwa}: ${currentStatus ? 'deaktywacja' : 'aktywacja'}`);
            
            try {
                const response = await fetch('/api/grupa-aktywna', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ kategoria: categoria, plec: plec, nazwa: nazwa })
                });
                
                const result = await response.json();
                log(`✅ Rezultat: ${result.action} - ${result.message}`);
                
                // Odśwież statusy
                await loadGroupStatuses();
                
            } catch (error) {
                log('❌ Błąd toggle: ' + error.message);
            }
        }

        function renderGroups() {
            const container = document.getElementById('groups');
            container.innerHTML = '';
            
            const groups = [
                { kategoria: 'Junior A', plec: 'M', nazwa: 'Junior A Mężczyźni' },
                { kategoria: 'Junior A', plec: 'K', nazwa: 'Junior A Kobiety' },
                { kategoria: 'Junior B', plec: 'M', nazwa: 'Junior B Mężczyźni' },
                { kategoria: 'Junior B', plec: 'K', nazwa: 'Junior B Kobiety' },
                { kategoria: 'Senior', plec: 'M', nazwa: 'Senior Mężczyźni' },
                { kategoria: 'Senior', plec: 'K', nazwa: 'Senior Kobiety' }
            ];
            
            groups.forEach(group => {
                const groupKey = `${group.kategoria}_${group.plec}`;
                const status = grupyStatuses[groupKey];
                const isActive = status?.is_active || false;
                const count = status?.count || 0;
                
                const div = document.createElement('div');
                div.className = 'group';
                div.innerHTML = `
                    <h3>${group.nazwa}</h3>
                    <div class="status">Status: ${isActive ? '🟢 Aktywna' : '⚪ Nieaktywna'} | Zawodnicy: ${count}</div>
                    <button 
                        class="btn ${isActive ? 'btn-active' : 'btn-inactive'}"
                        onclick="toggleGroup('${group.kategoria}', '${group.plec}', '${group.nazwa}')"
                    >
                        ${isActive ? 'Aktywna' : 'Aktywuj'}
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<div>${time}: ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // Uruchom przy załadowaniu
        loadGroupStatuses();
        
        // Odśwież co 5 sekund
        setInterval(loadGroupStatuses, 5000);
    </script>
</body>
</html> 